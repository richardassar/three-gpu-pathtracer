var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},a={},t={},n=e.parcelRequire5b70;null==n&&((n=function(e){if(e in a)return a[e].exports;if(e in t){var n=t[e];delete t[e];var r={id:e,exports:{}};return a[e]=r,n.call(r.exports,r,r.exports),r.exports}var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,a){t[e]=a},e.parcelRequire5b70=n);var r=n("ilwiq"),o=n("RPVlj"),i=n("7lx9d"),s=n("5Rd1x"),l=n("4CEV9"),d=n("cVdfP"),m=n("891vQ"),c=n("kp7Te"),h=n("jiuw3");let u,p,g,C,w,v,b,y,S,f,M,x,T;const F={material1:{color:"#ffc766",emissive:"#000000",emissiveIntensity:1,roughness:.1,metalness:.8,ior:1.495,transmission:0,opacity:1,matte:!1,castShadow:!0},material2:{color:"#db7157",emissive:"#000000",emissiveIntensity:1,roughness:.8,metalness:.1,transmission:0,ior:1.495,opacity:1,matte:!1,castShadow:!0},material3:{color:"#000000",roughness:.01,metalness:.05,matte:!1,castShadow:!0},multipleImportanceSampling:!0,stableNoise:!1,environmentIntensity:3,environmentRotation:0,environmentBlur:0,backgroundBlur:.05,bounces:5,samplesPerFrame:1,acesToneMapping:!0,resolutionScale:1/window.devicePixelRatio,transparentTraversals:20,filterGlossyFactor:.5,tiles:1,backgroundAlpha:1,checkerboardTransparency:!0,cameraProjection:"Perspective"};window.location.hash.includes("transmission")&&(F.material1.metalness=0,F.material1.roughness=.05,F.material1.transmission=1,F.material1.color="#ffffff",F.bounces=10);function R(){const e=window.innerWidth,a=window.innerHeight,t=F.resolutionScale,n=window.devicePixelRatio;C.setSize(e*t*n,a*t*n),C.reset(),u.setSize(e,a),u.setPixelRatio(window.devicePixelRatio*t);const r=e/a;y.aspect=r,y.updateProjectionMatrix();const o=5/r;S.top=o/2,S.bottom=o/-2,S.updateProjectionMatrix()}function P(){C.reset()}function I(){const e=M.generate(f,F.environmentBlur);C.material.envMapInfo.updateFrom(e),x.environment=e,C.reset()}function B(e){"Perspective"===e?(w&&y.position.copy(w.position),w=y):(w&&S.position.copy(w.position),w=S),p.object=w,C.camera=w,p.update(),P()}function A(){requestAnimationFrame(A);const e=b[0];e.color.set(F.material1.color).convertSRGBToLinear(),e.emissive.set(F.material1.emissive).convertSRGBToLinear(),e.emissiveIntensity=F.material1.emissiveIntensity,e.metalness=F.material1.metalness,e.roughness=F.material1.roughness,e.transmission=F.material1.transmission,e.ior=F.material1.ior,e.opacity=F.material1.opacity;const a=b[1];a.color.set(F.material2.color).convertSRGBToLinear(),a.emissive.set(F.material2.emissive).convertSRGBToLinear(),a.emissiveIntensity=F.material2.emissiveIntensity,a.metalness=F.material2.metalness,a.roughness=F.material2.roughness,a.transmission=F.material2.transmission,a.ior=F.material2.ior,a.opacity=F.material2.opacity;const t=b[2];t.color.set(F.material3.color).convertSRGBToLinear(),t.metalness=F.material3.metalness,t.roughness=F.material3.roughness,C.material.materials.updateFrom(g.materials,g.textures),C.material.materials.setMatte(0,F.material1.matte),C.material.materials.setMatte(1,F.material2.matte),C.material.materials.setMatte(2,F.material3.matte),C.material.materials.setCastShadow(0,F.material1.castShadow),C.material.materials.setCastShadow(1,F.material2.castShadow),C.material.materials.setCastShadow(2,F.material3.castShadow),C.material.filterGlossyFactor=F.filterGlossyFactor,C.material.environmentIntensity=F.environmentIntensity,C.material.backgroundBlur=F.backgroundBlur,C.material.bounces=F.bounces,C.material.backgroundAlpha=F.backgroundAlpha,C.material.physicalCamera.updateFrom(w),w.updateMatrixWorld(),F.backgroundAlpha<1?x.background=null:x.background=x.environment;for(let e=0,a=F.samplesPerFrame;e<a;e++)C.update();C.samples<1&&u.render(x,w),u.autoClear=!1,v.material.map=C.target.texture,v.render(u),u.autoClear=!0,T.innerText=`Samples: ${Math.floor(C.samples)}`}window.innerWidth/window.innerHeight<.65&&(F.bounces=Math.max(F.bounces,6),F.resolutionScale*=.5,F.tiles=2,F.multipleImportanceSampling=!1,F.environmentBlur=.35),async function(){u=new r.WebGLRenderer({antialias:!0}),u.toneMapping=r.ACESFilmicToneMapping,u.setClearColor(0,0),document.body.appendChild(u.domElement);const e=window.innerWidth/window.innerHeight;y=new l.PhysicalCamera(75,e,.025,500),y.position.set(-4,2,3);const a=5/e;S=new r.OrthographicCamera(-2.5,2.5,a/2,a/-2,0,100),S.position.set(-4,2,3),C=new l.PathTracingRenderer(u),C.alpha=!0,C.material=new l.PhysicalPathTracingMaterial,C.material.setDefine("TRANSPARENT_TRAVERSALS",F.transparentTraversals),C.material.setDefine("FEATURE_MIS",Number(F.multipleImportanceSampling)),C.tiles.set(F.tiles,F.tiles),v=new o.FullScreenQuad(new r.MeshBasicMaterial({map:C.target.texture,blending:r.CustomBlending})),p=new s.OrbitControls(y,u.domElement),p.addEventListener("change",(()=>{C.reset()})),x=new r.Scene,T=document.getElementById("samples"),M=new l.BlurredEnvMapGenerator(u);const t=new Promise((e=>{(new m.RGBELoader).load("https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/royal_esplanade_1k.hdr",(a=>{f=a,I(),e()}))})),n=new d.PathTracingSceneWorker,w=(new i.GLTFLoader).setMeshoptDecoder(c.MeshoptDecoder).loadAsync("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/material-balls/material_ball_v2.glb").then((e=>{const a=new r.Group;e.scene.scale.setScalar(.01),e.scene.updateMatrixWorld(),a.add(e.scene);const t=new r.Box3;t.setFromObject(e.scene);const o=new r.Mesh(new r.CylinderBufferGeometry(3,3,.05,200),new r.MeshStandardMaterial({color:16777215,roughness:0,metalness:.25}));o.geometry=o.geometry.toNonIndexed(),o.geometry.clearGroups(),o.position.y=t.min.y-.03,a.add(o);const i=new r.MeshStandardMaterial,s=new r.MeshStandardMaterial;return e.scene.traverse((e=>{e.geometry&&e.geometry.computeVertexNormals(),"Sphere_1"===e.name?e.material=s:e.material=i,"subsphere_1"===e.name&&(e.material=s)})),b=[i,s,o.material],n.generate(a)})).then((e=>{g=e,x.add(e.scene);const{bvh:a,textures:t,materials:r}=e,o=a.geometry,i=C.material;i.bvh.updateFrom(a),i.normalAttribute.updateFrom(o.attributes.normal),i.tangentAttribute.updateFrom(o.attributes.tangent),i.uvAttribute.updateFrom(o.attributes.uv),i.materialIndexAttribute.updateFrom(o.attributes.materialIndex),i.textures.setTextures(u,2048,2048,t),i.materials.updateFrom(r,t),n.dispose()}));await Promise.all([w,t]),document.getElementById("loading").remove(),document.body.classList.add("checkerboard"),R(),window.addEventListener("resize",R);const k=new h.GUI;B(F.cameraProjection);const E=k.addFolder("Path Tracing");E.add(F,"acesToneMapping").onChange((e=>{u.toneMapping=e?r.ACESFilmicToneMapping:r.NoToneMapping,v.material.needsUpdate=!0})),E.add(F,"stableNoise").onChange((e=>{C.stableNoise=e})),E.add(F,"multipleImportanceSampling").onChange((e=>{C.material.setDefine("FEATURE_MIS",Number(e)),C.reset()})),E.add(F,"tiles",1,4,1).onChange((e=>{C.tiles.set(e,e)})),E.add(F,"samplesPerFrame",1,10,1),E.add(F,"filterGlossyFactor",0,1).onChange((()=>{C.reset()})),E.add(F,"bounces",1,30,1).onChange((()=>{C.reset()})),E.add(F,"transparentTraversals",0,40,1).onChange((e=>{C.material.setDefine("TRANSPARENT_TRAVERSALS",e),C.reset()})),E.add(F,"resolutionScale",.1,1).onChange((()=>{R()}));const G=k.addFolder("Environment");G.add(F,"environmentIntensity",0,10).onChange((()=>{C.reset()})),G.add(F,"environmentRotation",0,2*Math.PI).onChange((e=>{C.material.environmentRotation.setFromMatrix4((new r.Matrix4).makeRotationY(e)),C.reset()})),G.add(F,"environmentBlur",0,1).onChange((()=>{I()})),G.add(F,"backgroundBlur",0,1).onChange((()=>{C.reset()})),G.add(F,"backgroundAlpha",0,1).onChange((()=>{C.reset()})),G.add(F,"checkerboardTransparency").onChange((e=>{e?document.body.classList.add("checkerboard"):document.body.classList.remove("checkerboard")}));const L=k.addFolder("Camera");L.add(F,"cameraProjection",["Perspective","Orthographic"]).onChange((e=>{B(e)})),L.add(y,"focusDistance",1,100).onChange(P),L.add(y,"apertureBlades",0,10,1).onChange((function(e){y.apertureBlades=0===e?0:Math.max(e,3),this.updateDisplay(),P()})),L.add(y,"apertureRotation",0,12.5).onChange(P),L.add(y,"anamorphicRatio",.1,10).onChange(P),L.add(y,"bokehSize",0,50).onChange(P).listen(),L.add(y,"fStop",.3,20).onChange(P).listen(),L.add(y,"fov",25,100).onChange((()=>{y.updateProjectionMatrix(),P()})).listen();const N=k.addFolder("Shell Material");N.addColor(F.material1,"color").onChange(P),N.addColor(F.material1,"emissive").onChange(P),N.add(F.material1,"emissiveIntensity",0,50,.01).onChange(P),N.add(F.material1,"roughness",0,1).onChange(P),N.add(F.material1,"metalness",0,1).onChange(P),N.add(F.material1,"opacity",0,1).onChange(P),N.add(F.material1,"transmission",0,1).onChange(P),N.add(F.material1,"ior",.9,3).onChange(P),N.add(F.material1,"matte").onChange(P),N.add(F.material1,"castShadow").onChange(P),N.close();const j=k.addFolder("Ball Material");j.addColor(F.material2,"color").onChange(P),j.addColor(F.material2,"emissive").onChange(P),j.add(F.material2,"emissiveIntensity",0,50,.01).onChange(P),j.add(F.material2,"roughness",0,1).onChange(P),j.add(F.material2,"metalness",0,1).onChange(P),j.add(F.material2,"opacity",0,1).onChange(P),j.add(F.material2,"transmission",0,1).onChange(P),j.add(F.material2,"ior",.9,3).onChange(P),j.add(F.material2,"matte").onChange(P),j.add(F.material2,"castShadow").onChange(P),j.close();const _=k.addFolder("Floor Material");_.addColor(F.material3,"color").onChange(P),_.add(F.material3,"roughness",0,1).onChange(P),_.add(F.material3,"metalness",0,1).onChange(P),_.add(F.material3,"matte").onChange(P),_.add(F.material3,"castShadow").onChange(P),_.close(),A()}();
//# sourceMappingURL=materialBall.2d30a0c5.js.map
